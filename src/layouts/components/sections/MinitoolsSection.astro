---
import { getEntryCTM } from "@/lib/customContentLoader.astro";
import overrideObjects from "@/lib/utils/overrideObjects.ts";
import { markdownify } from "@/lib/utils/textConverter";
import type { Section } from "@/types";

type MinitoolItem = {
  title: string;
  description?: string;
  url?: string;
  image?: string;
};

type MinitoolsInterface = Section & {
  items?: MinitoolItem[];
};

type Props = {
  content?: MinitoolsInterface;
};

let defaultContent = (
  await getEntryCTM("sections", "minitools-section", Astro.currentLocale)
)
  ?.data as MinitoolsInterface;

let actualContent = overrideObjects(
  { ...defaultContent },
  Astro.props.content,
) as MinitoolsInterface;

const {
  enable = true,
  title = "Jessicaâ€™s SEO Minitools",
  description,
  items = [],
} = actualContent || {};

if (!enable) {
  return null;
}
---

<section id="minitools" data-aos="fade" data-aos-duration="300">
  <div class="bg-white py-16 border-b-2 border-black">
    <div class="container space-y-8">
      <div class="text-center space-y-3">
        <h2 data-aos="reveal-anim-top" data-aos-duration="1000" class="text-3xl font-bold uppercase tracking-tight text-black" set:html={markdownify(title)} />
        {description && (
          <p class="mx-auto max-w-2xl text-gray-600 font-mono text-sm leading-relaxed" set:html={markdownify(description)} />
        )}
      </div>

      {
        items.length > 0 ? (
          <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3 max-w-5xl mx-auto">
            {items.map((tool) => (
              <a
                class="group block p-6 border-2 border-black bg-white hover:bg-black hover:text-white transition-colors duration-0"
                href={tool.url || "#"}
                target={tool.url?.startsWith("http") ? "_blank" : undefined}
                rel={tool.url?.startsWith("http") ? "noopener noreferrer" : undefined}
              >
                <div class="flex flex-col gap-4">
                  <div class="flex items-center justify-between">
                     {tool.image ? (
                        <img src={tool.image} alt={tool.title} class="size-10 object-cover border-2 border-black group-hover:border-white" loading="lazy" />
                      ) : (
                        <div class="size-10 border-2 border-black bg-gray-50 text-black grid place-items-center font-bold text-xs uppercase group-hover:bg-white group-hover:text-black group-hover:border-white transition-colors">SEO</div>
                      )}
                      
                      <div class="opacity-0 group-hover:opacity-100 transition-opacity">
                         <span class="text-xs font-bold uppercase tracking-widest">Open</span>
                      </div>
                  </div>
                 
                  <div class="space-y-2">
                    <h3 class="text-xl font-bold uppercase tracking-tight group-hover:text-white">{tool.title}</h3>
                    {tool.description && (
                      <p class="text-sm font-secondary leading-relaxed opacity-80 group-hover:text-white/90" set:html={markdownify(tool.description)} />
                    )}
                  </div>
                </div>
              </a>
            ))}
          </div>
        ) : (
          <div class="mx-auto max-w-2xl border-2 border-black p-6 text-center text-gray-500 font-mono text-sm">
            Add your tools in <code class="bg-gray-100 px-1">src/content/sections/english/minitools-section.md</code>.
          </div>
        )
      }
    </div>
  </div>
</section>
