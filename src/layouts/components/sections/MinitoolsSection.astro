---
import { getEntryCTM } from "@/lib/customContentLoader.astro";
import overrideObjects from "@/lib/utils/overrideObjects.ts";
import { markdownify } from "@/lib/utils/textConverter";
import type { Section } from "@/types";

type MinitoolItem = {
  title: string;
  description?: string;
  url?: string;
  image?: string;
};

type MinitoolsInterface = Section & {
  items?: MinitoolItem[];
};

type Props = {
  content?: MinitoolsInterface;
};

let defaultContent = (
  await getEntryCTM("sections", "minitools-section", Astro.currentLocale)
)
  ?.data as MinitoolsInterface;

let actualContent = overrideObjects(
  { ...defaultContent },
  Astro.props.content,
) as MinitoolsInterface;

const {
  enable = true,
  title = "Jessica’s SEO Minitools",
  description,
  items = [],
} = actualContent || {};

if (!enable) {
  return null;
}
---

<section id="minitools" data-aos="fade" data-aos-duration="300">
  <div class="bg-theme-darker py-20 md:py-32 decor-spot">
    <div class="container space-y-10">
      <div class="text-center space-y-4">
        <h2 data-aos="reveal-anim-top" data-aos-duration="1000" class="section-title text-h1-sm md:text-h1 text-light" set:html={markdownify(title)} />
        {description && (
          <p class="mx-auto max-w-3xl text-light/80" set:html={markdownify(description)} />
        )}
      </div>

      {
        items.length > 0 ? (
          <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
            {items.map((tool) => (
              <a
                class="group block rounded-2xl border border-white/10 bg-white/5 p-6 backdrop-blur-sm transition-all duration-300 hover:-translate-y-1 hover:border-white/20 hover:bg-white/10 hover:ring-1 hover:ring-accent/30"
                href={tool.url || "#"}
                target={tool.url?.startsWith("http") ? "_blank" : undefined}
                rel={tool.url?.startsWith("http") ? "noopener noreferrer" : undefined}
              >
                <div class="flex items-start gap-4">
                  {tool.image ? (
                    <img src={tool.image} alt={tool.title} class="size-12 rounded-md object-cover" loading="lazy" />
                  ) : (
                    <div class="size-12 rounded-md bg-accent/20 text-accent grid place-items-center font-secondary text-lg">SEO</div>
                  )}
                  <div class="space-y-2">
                    <h3 class="text-light text-xl font-semibold">{tool.title}</h3>
                    {tool.description && (
                      <p class="text-light/70 text-sm" set:html={markdownify(tool.description)} />
                    )}
                  </div>
                </div>
                <div class="mt-4 text-accent font-medium">Learn more →</div>
              </a>
            ))}
          </div>
        ) : (
          <div class="mx-auto max-w-2xl rounded-xl border border-white/10 bg-white/5 p-6 text-center text-light/80">
            Add your tools in <code class="text-light">src/content/sections/english/minitools-section.md</code> with title, description, image and link.
          </div>
        )
      }
    </div>
  </div>
  
</section>
