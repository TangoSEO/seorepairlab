---
import type { z } from "astro/zod";
import type { Section } from "@/types";
import { getEntryCTM } from "@/lib/customContentLoader.astro";
import { markdownify } from "@/lib/utils/textConverter";
import CustomButton from "@/components/CustomButton.astro";
import overrideObjects from "@/lib/utils/overrideObjects.ts";
import type { bannerAgencySectionSchema } from "@/sections.schema";
import OptimizedImage from "@/components/utilities/OptimizedImage.astro";

// Type for this section data
type bannerAgency = Section &
  NonNullable<z.infer<typeof bannerAgencySectionSchema>>;

type Props = {
  content?: bannerAgency;
};

// Fetching the default content for the this section
let defaultContent = (
  await getEntryCTM("sections", "banner", Astro.currentLocale)
)?.data as bannerAgency;

// Enables content customization (e.g., title, description) with a fallback to 'defaultContent' if not provided.
// The 'content' prop should match the structure of 'defaultContent'.
// Allows using this section with different content across multiple pages.
// If 'content' is missing, 'defaultContent' will be used.
let actualContent = overrideObjects(
  { ...defaultContent },
  Astro.props.content,
) as bannerAgency;

// Extracting required values from 'content' object
let { title, image, titleSize, description, button } =
  actualContent as bannerAgency;

// Split title for improved readability: "Primary: Secondary"
let primaryTitle: string | undefined = undefined;
let secondaryTitle: string | undefined = undefined;
if (typeof title === "string" && title.includes(":")) {
  const parts = title.split(":");
  primaryTitle = parts[0]?.trim();
  secondaryTitle = parts.slice(1).join(":").trim();
} else if (typeof title === "string") {
  primaryTitle = title;
}

// Font sizes for the heading (useful if you have a long heading)
const fontSizeMap: Record<NonNullable<typeof titleSize>, string> = {
  "display-1": "text-display-3 lg:text-display-2 xl:text-display-1",
  "display-2": "text-display-5 md:text-display-3 xl:text-display-2",
  "display-3": "text-display-5 md:text-display-4 xl:text-display-3",
};

const fontSize = titleSize ? fontSizeMap[titleSize] : fontSizeMap["display-1"];
---

<section class="text-light mb-6 md:mb-24 bg-gradient-to-b from-[#000000] to-[#131312] pt-40 md:pt-52 pb-8 relative">
  <div class="container">
    <div class="mx-auto max-w-7xl space-y-7 text-center md:space-y-10">
      {
        (primaryTitle || secondaryTitle) && (
          <h1
            data-aos="reveal-anim-top"
            data-aos-duration="1500"
            class:list={[
              "text-inherit",
              fontSize,
              "block leading-tight font-bold break-words text-inherit uppercase tracking-tighter",
            ]}>
            {primaryTitle && (
              <span class="text-white" set:html={markdownify(primaryTitle)} />
            )}
            {secondaryTitle && (
              <span class="block text-inherit/80 text-xl md:text-2xl font-normal mt-4 max-w-3xl mx-auto normal-case tracking-normal" set:html={markdownify(secondaryTitle)} />
            )}
          </h1>
        )
      }
      {
        button?.enable ? (
          <div
            data-aos="reveal-anim-top"
            data-aos-duration="1500"
            data-aos-delay="200"
            class="mx-auto max-w-2xl space-y-6">
            {description && (
              <p
                class="text-base sm:text-lg text-inherit/80"
                set:html={markdownify(description)}
              />
            )}

            

            {/* SEO CORE High-Vis Highlight */}
            <div class="mx-auto my-6 p-8 border-2 border-green-600 bg-black/50 inline-block max-w-2xl relative">
                 <div class="absolute -top-3 left-1/2 -translate-x-1/2 bg-green-600 text-white text-xs font-bold px-3 py-1 uppercase tracking-widest">
                    Recommended
                </div>

                <span class="block text-green-500 font-bold uppercase tracking-widest text-sm mb-4">Including The New</span>
                <span class="block text-white text-5xl font-bold tracking-tighter mb-4">SEO CORE <span class="text-green-500">®</span></span>
                <span class="block text-white text-xl font-mono uppercase pb-6 mb-6 border-b border-green-600/30">$97/Mo Early Bird</span>
                
                <div class="flex flex-col md:flex-row justify-center gap-6 text-sm font-mono text-gray-300 mb-8">
                    <span class="flex items-center gap-2"><span class="text-green-500">✓</span> 3 Core Fixes/mo</span>
                    <span class="flex items-center gap-2"><span class="text-green-500">✓</span> Founder Supervision</span>
                </div>

                <a href="/apply/" class="inline-block bg-green-600 text-white font-bold uppercase tracking-widest py-4 px-8 hover:bg-green-500 transition-colors text-lg border-2 border-green-500">
                    Send Me More Info
                </a>
            </div>

            {/* Button Removed - Replaced by SEO Core Highlight */}
            <p class="mt-6 text-sm text-inherit/80">2M+ Pages Recovered | 180% Traffic Boost | CWV 'Good' on 20+ Sites</p>
          </div>
        ) : (
          description && (
            <p
              data-aos="reveal-anim-top"
              data-aos-delay="200"
              data-aos-duration="1500"
              class="mx-auto max-w-2xl text-lg text-inherit opacity-80"
              set:html={markdownify(description)}
            />
          )
        )
      }

      {
        image && (
          <div
            data-aos="reveal-anim-top"
            data-aos-duration="1500"
            data-aos-delay="300"
            data-aos-offset="0"
            class="mx-auto mt-10 -mb-24 max-w-4xl md:mt-20 md:-mb-32">
            <OptimizedImage
              src={image}
              alt={title || "Banner"}
              class="h-110 w-full object-cover md:h-135"
            />
          </div>
        )
      }
    </div>
  </div>
</section>
