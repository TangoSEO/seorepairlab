---
import type { Section } from "@/types";
import type { z } from "astro:content";
import { markdownify } from "@/lib/utils/textConverter";
import { getEntryCTM } from "@/lib/customContentLoader.astro";
import overrideObjects from "@/lib/utils/overrideObjects.ts";
import type { clientsSectionSchema } from "@/sections.schema";
import OptimizedImage from "../utilities/OptimizedImage.astro";

export type ClientsSection = Section & z.infer<typeof clientsSectionSchema> & {
  description?: string;
};

type Props = {
  content?: ClientsSection;
};

let defaultContent = (
  await getEntryCTM("sections", "clients", Astro.currentLocale)
)?.data as ClientsSection;

let actualContent = overrideObjects(
  { ...defaultContent },
  Astro.props.content,
) as ClientsSection;

let {
  enable = true,
  title,
  description,
  list,
  options: { appearance } = {},
} = actualContent;

const isDarkAppearance = appearance === "dark";

if (!enable) {
  return null;
}
---

<section data-aos="fade" data-aos-duration="300" class="bg-white py-16 border-b-2 border-black">
  <div class="container space-y-10">
    {
      title && (
        <div class="mx-auto max-w-4xl text-center space-y-3">
          <h2
            data-aos="reveal-anim-top"
            data-aos-duration="1000"
            class:list={[
              "text-3xl font-bold uppercase tracking-tight text-black",
              isDarkAppearance && "text-light",
            ]}
            set:html={markdownify(title)}
          />
          {description && (
             <p class="text-sm font-secondary opacity-80 max-w-2xl mx-auto" set:html={markdownify(description)} />
          )}
        </div>
      )
    }
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 max-w-5xl mx-auto">
      {
        list?.map((item, idx) => (
          <div
            data-aos="fade"
            data-aos-duration="300"
            data-aos-delay={String(idx * 75)}
            class="group border-2 border-black bg-white p-6 flex flex-col items-center justify-center gap-4 hover:bg-black hover:text-white transition-colors duration-0 min-h-[120px]">
            <div class="relative w-full flex items-center justify-center">
              <OptimizedImage width={160} height={40} src={item.src} alt={item.alt} class="max-h-10 w-auto grayscale brightness-0 group-hover:invert transition-all duration-0" />
            </div>
             <span class="text-[10px] font-bold uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-opacity absolute bottom-2">{item.alt}</span>
          </div>
        ))
      }
    </div>
  </div>
</section>
